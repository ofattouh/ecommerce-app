jQuery(document).ready(function(a){"use strict";function b(b){b.addClass("processing");var c=b.data();1!==c["blockUI.isBlocked"]&&b.block({message:null,overlayCSS:{background:"#fff url("+wc_checkout_params.ajax_loader_url+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),h=Math.round((new Date).getTime()/1e3),a("#wc-moneris-account-number")[0].contentWindow.postMessage("",wc_moneris_params.hosted_tokenization_url)}function c(b){if(-1!==b.origin.indexOf("moneris.com")){var c,d=a.parseJSON(b.data),e=Math.round((new Date).getTime()/1e3)-h;if(a.get(wc_moneris_params.ajaxurl,{action:"wc_payment_gateway_moneris_handle_hosted_tokenization_response",orderId:wc_moneris_params.order_id,responseCode:d.responseCode,errorMessage:d.errorMessage,token:d.dataKey,requestTime:e}),c=a(a("form.checkout").length?"form.checkout":"form#order_review"),c.removeClass("processing").unblock(),d.responseCode<50){if(a("#wc-moneris-use-new-payment-method").val(d.dataKey),a("#wc-moneris-temp-payment-token").val(1),a("#wc-moneris-card-bin").val(d.bin),c.submit(),!a("form.checkout").length){c.addClass("processing");var g=c.data();1!==g["blockUI.isBlocked"]&&c.block({message:null,overlayCSS:{background:"#fff url("+wc_checkout_params.ajax_loader_url+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}})}}else{a("#wc-moneris-use-new-payment-method").val(""),a("#wc-moneris-temp-payment-token").val("");var i=[];943===d.responseCode?i.push(wc_moneris_params.card_number_missing_or_invalid):i.push(wc_moneris_params.general_error),f(c,i)}}}function d(){window.addEventListener?window.addEventListener("message",c,!1):window.attachEvent&&window.attachEvent("onmessage",c)}function e(b){if(b.is(".processing"))return!1;var c=a(".payment_method_moneris"),d=c.find(".js-wc-payment-gateway-payment-token:checked").val();if(d)return!0;var e=[],g=c.find(".js-wc-payment-gateway-csc").val(),h=c.find(".js-wc-payment-gateway-card-exp-month").val(),i=c.find(".js-wc-payment-gateway-card-exp-year").val(),j=(new Date).getFullYear();return(/\D/.test(h)||/\D/.test(i)||h>12||h<1||i<j||i>j+20)&&e.push(wc_moneris_params.card_exp_date_invalid),"undefined"!=typeof g&&(g?(/\D/.test(g)&&e.push(wc_moneris_params.cvv_digits_invalid),(g.length<3||g.length>4)&&e.push(wc_moneris_params.cvv_length_invalid)):e.push(wc_moneris_params.cvv_missing)),!(e.length>0)||(f(b,e),!1)}function f(b,c){a(".woocommerce-error, .woocommerce-message").remove(),b.prepend('<ul class="woocommerce-error"><li>'+c.join("</li><li>")+"</li></ul>"),b.removeClass("processing").unblock(),b.find(".input-text, select").blur(),a("html, body").animate({scrollTop:b.offset().top-100},1e3)}function g(){a("input.js-wc-moneris-payment-token").change(function(){var b=a("input.js-wc-moneris-payment-token:checked").val(),c=a("div.js-wc-moneris-new-payment-method-form");b?(c.slideUp(200),wc_moneris_params.require_csc&&a(".js-wc-moneris-new-payment-method-form").after(a(".js-wc-moneris-csc").parent())):(c.slideDown(200),wc_moneris_params.require_csc&&a(".js-wc-moneris-csc-clear").before(a(".js-wc-moneris-csc").parent()))}).change(),a("input#createaccount").change(function(){var b;b=a("input.js-wc-moneris-tokenize-payment-method").closest("p.form-row"),a(this).is(":checked")?(b.slideDown(),b.next().show()):(b.hide(),b.next().hide())}).change()}var h=null;a("form.checkout").length?(d(),a("body").bind("updated_checkout",function(){g()}),a("form.checkout").bind("checkout_place_order_moneris",function(){return!a("#wc-moneris-use-new-payment-method").is(":checked")&&!a("#wc-moneris-use-new-payment-method").is('input[type="hidden"]')||a("#wc-moneris-use-new-payment-method").val()?e(a(this)):(b(a(this)),!1)})):(g(),d(),a("form#order_review").submit(function(){if("moneris"===a("#order_review input[name=payment_method]:checked").val())return!a("#wc-moneris-use-new-payment-method").is(":checked")&&!a("#wc-moneris-use-new-payment-method").is('input[type="hidden"]')||a("#wc-moneris-use-new-payment-method").val()?e(a(this)):(b(a(this)),!1)}))});